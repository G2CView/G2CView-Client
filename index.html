<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>
<body>
<div id="app">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">G2CView</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container-fluid">
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js"
        integrity="sha256-gfQwA6PlkZsLqWu4bU4hXPrbTqzixm0B5MdvBLI+Oas=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

<!-- Custom JS for creating the visualization. -->
<script type="text/javascript">
    function get_nodes(current_property, only_leaves = false)
    {
        let nodes = [];
        let property_is_enabled = true;

        let property_has_children = (current_property.children !== undefined);

        if (only_leaves === true){
            property_is_enabled = current_property.enabled;
        }

        if (property_has_children && property_is_enabled)
        {
            let children = current_property.children;
            for (let child in children)
            {
                const child_node_data = get_nodes(children[child], only_leaves);
                nodes = nodes.concat(child_node_data);
            }
        }
        else
        {
            nodes.push(current_property);
        }

        if ((only_leaves !== true) && property_has_children) {
            nodes.push(current_property);
        }

        return nodes
    }

    function get_leafs(current_property)
    {
        return get_nodes(current_property, true)
    }

    function get_number_of_leaves(current_property)
    {
        return get_leafs(current_property).length;
    }

    function get_leaf_data(current_property)
    {
        let node_data = [];

        let leaf_nodes = get_leafs(current_property);

        for (let node in leaf_nodes)
        {
            node_data.push({'name': leaf_nodes[node]['name'], 'result': leaf_nodes[node]['result']});
        }
        $.getJSON("configs/diagram_configuration.json", function (diagram_parameters) {

        return node_data
    }

    function doubly_link_tree(current_property)
    {
        let property_has_children = (current_property.children !== undefined);

        if (property_has_children)
        {
            let children = current_property.children;
            for (let child in children)
            {
                let child_property = children[child];

                child_property.parent = current_property;
                doubly_link_tree(child_property);
            }
        }
    }

    function max_leaf_to_node(leafs)
    {
        let global_max_node_hop = 0;
        for (let leaf_index in leafs)
        {
            let leaf = leafs[leaf_index];

            let current_leaf_parent_hopes = 0;

            while (leaf.parent !== undefined)
            {
                current_leaf_parent_hopes += 1;
                leaf = leaf.parent;
            }

            if (current_leaf_parent_hopes > global_max_node_hop)
            {
                global_max_node_hop = current_leaf_parent_hopes
            }
        }

        return global_max_node_hop
    }

    function create_node_index(nodes) {
        let node_index = {};
        let node_identifier = 0;

        for (let node in nodes){
            let current_property = nodes[node];
            current_property.node_id = node_identifier;
            node_index[node_identifier] = current_property;
            node_identifier++;
        }

        return node_index
    }

    $.getJSON("data/example_genome_property.json", function (genome_properties_data) {
        let genome_properties_tree = genome_properties_data['property_tree'];
        doubly_link_tree(genome_properties_tree);
        let leafs = get_leafs(genome_properties_tree);
        let nodes = get_nodes(genome_properties_tree);
        let leaf_data = get_leaf_data(genome_properties_tree);
        let number_of_leaves = get_number_of_leaves(genome_properties_tree);
        let max_nodes_to_leaf = max_leaf_to_node(leafs);
        let node_index = create_node_index(nodes);

        console.log(genome_properties_tree);
        console.log(leafs);
        console.log(nodes);
        console.log(leaf_data);
        console.log(number_of_leaves);
        console.log(max_nodes_to_leaf);
        console.log(node_index);
        });
    });
</script>
</body>
</html>
